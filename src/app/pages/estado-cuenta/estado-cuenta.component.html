<div class="container-fluid">

  <!-- Filtros -->
  <div class="row mb-4">
    <!-- Tipo de contrato -->
    <div class="col-md-3 col-12 mb-2">
      <label>Tipo</label>
      <select class="form-control" [(ngModel)]="tipoSeleccionado" (change)="cargarContratos()">
        <option value="PRE">Prepago</option>
        <option value="POS">Pospago</option>
      </select>
    </div>

    <!-- Contrato -->
    <div class="col-md-3 col-12 mb-2">
      <label>Contrato</label>
      <select class="form-control" [(ngModel)]="contratoSeleccionado">
        <option *ngFor="let contrato of contratos" [ngValue]="contrato.idContrato">
          {{contrato.nroContrato}}
        </option>
      </select>
    </div>

    <!-- Periodo -->
    <div class="col-md-3 col-12 mb-2">
      <label>Periodo</label>
      <input type="month" class="form-control" [(ngModel)]="periodoSeleccionado">
    </div>

    <!-- Bot√≥n -->
    <div class="col-md-3 col-12 d-flex align-items-end">
      <button class="btn btn-primary w-100" (click)="buscarEstadoCuenta()">
        üîç Buscar
      </button>
    </div>
  </div>

  <!-- ============================= -->
  <!-- Vista PREPAGO -->
  <!-- ============================= -->
  <div *ngIf="tipoSeleccionado === 'PRE' && estadoCuenta">
    <!-- Resumen -->
    <div class="row text-white mb-4">
      <div class="col-md-3 col-6 mb-3">
        <div class="card bg-info shadow text-center p-3">
          <h6>Saldo Inicial</h6>
          <h4>S/ {{estadoCuenta.saldoInicial | number:'1.2-2'}}</h4>
        </div>
      </div>
      <div class="col-md-3 col-6 mb-3">
        <div class="card bg-danger shadow text-center p-3">
          <h6>Cargos</h6>
          <h4>S/ {{estadoCuenta.cargos | number:'1.2-2'}}</h4>
        </div>
      </div>
      <div class="col-md-3 col-6 mb-3">
        <div class="card bg-success shadow text-center p-3">
          <h6>Abonos</h6>
          <h4>S/ {{estadoCuenta.abonos | number:'1.2-2'}}</h4>
        </div>
      </div>
      <div class="col-md-3 col-6 mb-3">
        <div class="card bg-primary shadow text-center p-3">
          <h6>Saldo Final</h6>
          <h4>S/ {{estadoCuenta.saldoFinal | number:'1.2-2'}}</h4>
        </div>
      </div>
    </div>

    <!-- Movimientos -->
    <div class="card shadow">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold text-primary">Movimientos</h6>
      </div>
      <div class="card-body table-responsive">
        <table class="table table-bordered">
          <thead class="table-light">
            <tr>
              <th>Fecha</th>
              <th>Tipo</th>
              <th>Descripci√≥n</th>
              <th class="text-end">Monto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let mov of estadoCuenta.movimientos">
              <td>{{mov.fecha}}</td>
              <td>{{mov.tipo}}</td>
              <td>{{mov.descripcion}}</td>
              <td [ngClass]="{'text-success': mov.monto > 0, 'text-danger': mov.monto < 0}" class="text-end">
                {{mov.monto | currency:'PEN':'symbol-narrow'}}
              </td>
            </tr>
            <tr *ngIf="!estadoCuenta.movimientos || estadoCuenta.movimientos.length === 0">
              <td colspan="4" class="text-center">No hay movimientos registrados</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ============================= -->
  <!-- Vista POSPAGO -->
  <!-- ============================= -->
  <div *ngIf="tipoSeleccionado === 'POS' && estadoCuenta">
    <!-- Resumen -->
    <div class="row text-white mb-4">
      <div class="col-md-4 col-6 mb-3">
        <div class="card bg-danger shadow text-center p-3">
          <h6>Facturado</h6>
          <h4>S/ {{estadoCuenta.montoFacturado | number:'1.2-2'}}</h4>
        </div>
      </div>
      <div class="col-md-4 col-6 mb-3">
        <div class="card bg-success shadow text-center p-3">
          <h6>Pagado</h6>
          <h4>S/ {{estadoCuenta.montoPagado | number:'1.2-2'}}</h4>
        </div>
      </div>
      <div class="col-md-4 col-6 mb-3">
        <div class="card bg-primary shadow text-center p-3">
          <h6>Saldo Pendiente</h6>
          <h4>S/ {{estadoCuenta.saldoPendiente | number:'1.2-2'}}</h4>
        </div>
      </div>
    </div>

    <!-- Detalles -->
    <div class="card shadow">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold text-primary">Facturas y Pagos</h6>
      </div>
      <div class="card-body table-responsive">
        <table class="table table-bordered">
          <thead class="table-light">
            <tr>
              <th>N√∫mero</th>
              <th>Fecha</th>
              <th>Total</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let det of estadoCuenta.detalles">
              <td>{{det.numeroFactura}}</td>
              <td>{{det.fechaEmision}}</td>
              <td>{{det.total | currency:'PEN':'symbol-narrow'}}</td>
              <td>{{det.estado}}</td>
            </tr>
            <tr *ngIf="!estadoCuenta.detalles || estadoCuenta.detalles.length === 0">
              <td colspan="4" class="text-center">No hay consumos registrados</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
